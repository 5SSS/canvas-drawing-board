!function(t){var i={};function e(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e(1),h=e(2),n=e(3),o=e(4),a=e(5),c=e(6);class r{constructor({id:t="",background:i="#fff"}={}){let e=document.getElementById(t),s=document.createElement("canvas");const h=t=>{t.preventDefault()};s.width=e.offsetWidth,s.height=e.offsetHeight,e.appendChild(s),e.addEventListener("touchstart",function(t){document.addEventListener("touchmove",h,{passive:!1})},!1),e.addEventListener("touchend",function(t){document.removeEventListener("touchmove",h,{passive:!1})},!1),this.id=t,this.width=s.width,this.height=s.height,this.canvas=s,this.background=i,this.mode="pencil",this.radius=30,this.size=2,this.color="#ff4500",this.prevPoint={},this.ctx=s.getContext("2d"),this.ctx.lineWidth=this.size,this.ctx.strokeStyle=this.color,this.canDraw=!1,this.eventPool={},this.pointList=[],this.mousedown=l.bind(this),this.mousemove=m(d,this),this.mouseup=u.bind(this),this.initEvent(),this.setBackground(),this.install("polygon",new o.a(t)),this.install("text",new a.a(t)),this.install("image",new c.a(this))}initEvent(){navigator.userAgent.match(/AppleWebKit.*Mobile.*/)?(x(this.canvas,"touchstart",this.mousedown),x(this.canvas,"touchmove",this.mousemove),x(this.canvas,"touchend",this.mouseup)):(x(this.canvas,"mousedown",this.mousedown),x(this.canvas,"mousemove",this.mousemove),x(this.canvas,"mouseup",this.mouseup))}drawLine(t,i){this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(i.x,i.y),this.ctx.stroke()}eraser(t){let i=this.radius;this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,i,0,2*Math.PI),this.ctx.fillStyle=this.background,this.ctx.fill(),this.ctx.restore()}clear(){this.setBackground(),this.emit("change",{type:"clear"})}fill(t){let i=t||this.color;this.ctx.save(),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,this.width,this.height),this.ctx.restore(),this.emit("change",{type:"fill",data:{color:i}})}getMousePos(t){let i=t.clientX||t.touches[0].clientX,e=t.clientY||t.touches[0].clientY,s=this.canvas.getBoundingClientRect();return{x:i-s.left,y:e-s.top}}on(t,i){this.eventPool[t]=i}emit(t,...i){this.eventPool[t]&&this.eventPool[t].apply(this,i)}setBackground(){this.reFill(this.background),this.saveHistory()}saveHistory(){this.History.saveHistory(this.getBase64())}setSize(t){if("number"!=typeof t)return!1;this.size=t<=1?1:t>=10?10:t}setColor(t){if("string"!=typeof t)return!1;this.color=t,this.ctx.strokeStyle=this.color}resize(){let t=document.getElementById(this.id),i=this.getBase64(1);this.canvas.width=t.offsetWidth,this.canvas.height=t.offsetHeight,this.width=t.offsetWidth,this.height=t.offsetHeight;let e=document.createElement("img"),s=this;e.onload=function(){s.ctx.drawImage(e,0,0)},e.onerror=function(t){throw t},e.src=i}rePaintLine(t){let i=Object(s.e)(t.data,this.width,this.height);if(i.length<1)return!1;let e=i[0];this.ctx.save(),this.ctx.lineWidth=t.size,this.ctx.strokeStyle=t.color,i.forEach(t=>{this.drawLine(e,t),e=t}),this.ctx.restore()}rePaintText(t){this.ctx.save(),this.ctx.fillStyle=t.color,this.ctx.font="16px Arial";let i=t.y*this.height;t.data.forEach(e=>{this.ctx.beginPath(),this.ctx.fillText(e,t.x*this.width,i),i+=20}),this.ctx.restore()}rePaintCircle(t){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=t.size,this.ctx.strokeStyle=t.color,this.ctx.arc(t.x*this.width,t.y*this.height,t.r*this.width,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore()}rePaintRect(t){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=t.size,this.ctx.strokeStyle=t.color,this.ctx.rect(t.x*this.width,t.y*this.height,t.width*this.width,t.height*this.height),this.ctx.stroke(),this.ctx.restore()}rePaintEraser(t){let i=Object(s.e)(t.data,this.width,this.height),e=this.radius;this.radius=Math.max(e,this.width/t.width*e),i.forEach(t=>{this.eraser(t)}),this.radius=e}reMosaic(t){let i=this;Object(s.e)(t.data,this.width,this.height).forEach(t=>{Object(h.a)({ctx:i.ctx,point:t})})}reClear(){this.setBackground()}reFill(t){let i=t||this.color;this.ctx.save(),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,this.width,this.height),this.ctx.restore()}reLine(t){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=t.size,this.ctx.strokeStyle=t.color,this.ctx.moveTo(t.x*this.width,t.y*this.height),this.ctx.lineTo(t.endX*this.width,t.endY*this.height),this.ctx.stroke(),this.ctx.restore()}reArrow(t){console.log(t,1),this.ctx.beginPath(),this.ctx.fillStyle=t.color,this.ctx.moveTo(t.x*this.width,t.y*this.height),t.points.forEach(t=>{this.ctx.lineTo(t[0]*this.width,t[1]*this.height)}),this.ctx.lineTo(t.x*this.width,t.y*this.height),this.ctx.fill()}reDrawImage(t){let i=document.createElement("img"),e=this;i.onload=function(){if(i.width<=e.width)e.ctx.drawImage(i,0,0);else{let t=e.width/i.width;e.ctx.drawImage(i,0,0,e.width,i.height*t)}},i.onerror=function(t){throw t},i.src=t}getBase64(t=.7){return this.canvas.toDataURL("image/png",t)}setBase64(t){this.reDrawImage(t)}download({name:t="未命名图片",type:i="jpg"}={}){"jpg"!==i&&"png"!==i&&(i="jpg");let e=document.createElement("a"),h=Object(s.a)(this.getBase64());e.href=URL.createObjectURL(h),e.setAttribute("download",`${t}.${i}`),e.click()}prev(){let t=this.History.prevHistory();null!==t&&this.setBase64(t)}next(){let t=this.History.nextHistory();null!==t&&this.setBase64(t)}setModel(t){this.mode=t}install(t,i){r.prototype[t]=i}}i.default=r,r.prototype.History=new n.a;const l=function(t){this.canDraw=!0,this.prevPoint=this.getMousePos(t),this.pointList.push(this.prevPoint),this.ctx.lineCap="round",this.ctx.lineWidth=this.size,this.ctx.strokeStyle=this.color},d=function(t){if(!this.canDraw)return!1;let i=this.getMousePos(t);if("pencil"===this.mode)this.drawLine(this.prevPoint,i);else if("eraser"===this.mode)this.eraser(i);else{let t=this;Object(h.a)({ctx:t.ctx,point:i})}this.pointList.push(i),this.prevPoint=i},u=function(t){this.canDraw=!1,"pencil"===this.mode?(this.pointList=Object(s.c)(this.pointList,2),this.pointList=Object(s.d)(this.pointList,this.width,this.height),this.emit("change",{type:"line",data:{data:this.pointList,color:this.color,size:this.size}})):"eraser"===this.mode?(this.pointList=Object(s.b)(this.pointList,this.radius),this.pointList=Object(s.d)(this.pointList,this.width,this.height),this.emit("change",{type:"eraser",data:{data:this.pointList,width:this.width}})):(this.pointList=Object(s.b)(this.pointList,30),this.pointList=Object(s.d)(this.pointList,this.width,this.height),this.emit("change",{type:"mosaic",data:{data:this.pointList,width:this.width}})),this.pointList=[],this.saveHistory()},x=(t,i,e)=>{t.addEventListener(i,e,!1)},m=(t,i)=>{let e=null;return function(s){if(e)return!1;e=setTimeout(()=>{clearInterval(e),e=null},16.7),t.call(i,s)}};window.Board=r},function(t,i,e){"use strict";i.b=((t,i)=>{if(t.length<=1)return t;let e=0,s=1,h=t.length;for(;s<h;)Math.abs(t[s].x-t[e].x)<i/2&&Math.abs(t[s].y-t[e].y)<i/2?t.splice(s,1):(e++,s++),h--;return t});i.c=((t,i)=>{if(t.length<=1)return t;let e=0,s=1,h=t.length;for(;s<h;)Math.abs(t[s].x-t[e].x)<=i&&Math.abs(t[s].y-t[e].y)<=i?t.splice(s,1):(e++,s++),h--;return t});i.d=((t,i,e)=>t.map(t=>Object.assign(t,{x:t.x/i,y:t.y/e})));i.e=((t,i,e)=>t.map(t=>Object.assign(t,{x:t.x*i,y:t.y*e})));i.a=(t=>{let i=t.split(";base64,"),e=i[0].split(":")[1],s=window.atob(i[1]),h=s.length,n=new Uint8Array(h);for(let t=0;t<h;++t)n[t]=s.charCodeAt(t);return new Blob([n],{type:e})})},function(t,i,e){"use strict";i.a=(({ctx:t,point:i,size:e=30,msize:n=5}={})=>{let o=t.getImageData(i.x-e/2,i.y-e/2,e,e),a=o.width/n,c=o.height/n;for(let t=0;t<c;t++)for(let i=0;i<a;i++){let e=s(o,i*n+Math.floor(Math.random()*n),t*n+Math.floor(Math.random()*n));for(let s=0;s<n;s++)for(let a=0;a<n;a++)h(o,i*n+a,t*n+s,e)}t.putImageData(o,i.x-e/2,i.y-e/2)});const s=(t,i,e)=>{let s=t.width,h=[];return h[0]=t.data[4*(e*s+i)],h[1]=t.data[4*(e*s+i)+1],h[2]=t.data[4*(e*s+i)+2],h[3]=t.data[4*(e*s+i)+3],h},h=(t,i,e,s)=>{let h=t.width;t.data[4*(e*h+i)]=s[0],t.data[4*(e*h+i)+1]=s[1],t.data[4*(e*h+i)+2]=s[2],t.data[4*(e*h+i)+3]=s[3]}},function(t,i,e){"use strict";i.a=class{constructor({maxLength:t=30}={}){this.maxLength=t,this.historyList=[],this.index=0,this.canNext=!1}saveHistory(t){0===this.historyList.length||this.index===this.historyList.length-1?(this.historyList.push(t),this.index=this.historyList.length-1,this.historyList.length>this.maxLength&&this.historyList.shift()):(this.historyList.splice(this.index+1,1,t),this.index=this.index+1),this.canNext=!1}prevHistory(){return this.canNext=!0,this.index<=0?null:this.historyList[--this.index]}nextHistory(){return!this.canNext||this.index>=this.historyList.length-1?null:this.historyList[++this.index]}}},function(t,i,e){"use strict";i.a=class{constructor(t){let i=document.getElementById(t),e=document.createElement("canvas");this.id=t,this.wrap=i,this.stroke=1,this.x=0,this.y=0,this.endX=0,this.endY=0,this.tempXY={},this.endWidth=0,this.endHeight=0,this.radius=5,this.lock=!0,this.canvas=e,this.context=e.getContext("2d"),this.mousedown=this.mousedown.bind(this),this.mousemove=this.mousemove.bind(this),this.mouseup=this.mouseup.bind(this),this.tempCtx=null,this.module="circle",this.mobileAdd=!1,this.pcAdd=!1}addEvent(){let t=this.wrap;if(this.canvas.style.cssText=`position: absolute;left:0;top:0; width: ${t.offsetWidth}px;height: ${t.offsetHeight}px; z-index: 9999;`,this.canvas.width=t.offsetWidth,this.canvas.height=t.offsetHeight,navigator.userAgent.match(/AppleWebKit.*Mobile.*/)&&!this.mobileAdd)return console.log("mobile"),this.canvas.addEventListener("touchstart",t=>{let i=t.touches[0];this.mousedown({clientX:i.pageX,clientY:i.pageY})},!1),this.canvas.addEventListener("touchmove",t=>{let i=t.touches[0];this.mousemove({clientX:i.pageX,clientY:i.pageY})},!1),this.canvas.addEventListener("touchend",t=>{this.mouseup(),t.preventDefault()},!1),this.mobileAdd=!0,!1;navigator.userAgent.match(/AppleWebKit.*Mobile.*/)||this.pcAdd||(console.log("pc"),this.canvas.addEventListener("mousedown",this.mousedown,!1),this.canvas.addEventListener("mousemove",this.mousemove,!1),this.canvas.addEventListener("mouseup",this.mouseup,!1),this.pcAdd=!0)}initArcAction(t){this.addEvent(),this.tempCtx=t,this.stroke=t.size,this.context.strokeStyle=t.color,this.wrap.appendChild(this.canvas)}addCircle(t){this.initArcAction(t),this.module="circle"}addRect(t){this.initArcAction(t),this.module="rect"}addLine(t){this.initArcAction(t),this.module="line"}addArrow(t){this.initArcAction(t),this.module="arrow"}mousedown(t){let i=this.getMousePos(t);this.x=i.x,this.y=i.y,this.lock=!1}mousemove(t){if(this.lock)return!1;let i=this.getMousePos(t);switch(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.module){case"circle":let t=Math.abs(i.x-this.x),e=Math.abs(i.y-this.y),s=Math.min(i.x,this.x),h=Math.min(i.y,this.y);this.tempXY={x:s+t/2,y:h+e/2},this.radius=Math.sqrt(t*t+e*e)/2,this.arcCircle(this.tempXY.x,this.tempXY.y,this.radius);break;case"rect":this.endWidth=i.x-this.x,this.endHeight=i.y-this.y,this.arcRect(this.endWidth,this.endHeight);break;case"line":this.endX=i.x,this.endY=i.y,this.arcLine(this.endX,this.endY);break;case"arrow":this.endX=i.x,this.endY=i.y,this.arcArrow(this.endX,this.endY,this.context)}}mouseup(){this.lock=!0;let t=null,i="";switch(this.module){case"circle":this.tempCtx.ctx.beginPath(),this.tempCtx.ctx.arc(this.tempXY.x,this.tempXY.y,this.radius,0,2*Math.PI),this.tempCtx.ctx.stroke(),t={x:this.tempXY.x/this.canvas.width,y:this.tempXY.y/this.canvas.height,r:this.radius/this.canvas.width,color:this.tempCtx.color,size:this.tempCtx.size},i="circle";break;case"rect":this.tempCtx.ctx.beginPath(),this.tempCtx.ctx.rect(this.x,this.y,this.endWidth,this.endHeight),this.tempCtx.ctx.stroke(),t={x:this.x/this.canvas.width,y:this.y/this.canvas.height,width:this.endWidth/this.canvas.width,height:this.endHeight/this.canvas.height,color:this.tempCtx.color,size:this.tempCtx.size},i="rect";break;case"line":this.tempCtx.ctx.beginPath(),this.tempCtx.ctx.moveTo(this.x,this.y),this.tempCtx.ctx.lineTo(this.endX,this.endY),this.tempCtx.ctx.stroke(),t={x:this.x/this.canvas.width,y:this.y/this.canvas.height,endX:this.endX/this.canvas.width,endY:this.endY/this.canvas.height,color:this.tempCtx.color,size:this.tempCtx.size},i="straightLine";break;case"arrow":let e=this.arcArrow(this.endX,this.endY,this.tempCtx.ctx);e=e.map(t=>(t[0]=t[0]/this.canvas.width,t[1]=t[1]/this.canvas.height,t)),t={x:this.x/this.canvas.width,y:this.y/this.canvas.height,endX:this.endX/this.canvas.width,endY:this.endY/this.canvas.height,points:e,color:this.tempCtx.color},i="arrow"}this.exportEvent(i,t),this.resetCanvas(),this.wrap.removeChild(this.canvas)}exportEvent(t,i){this.tempCtx.emit("change",{type:t,data:i}),this.tempCtx.saveHistory()}arcCircle(t,i,e){this.context.beginPath(),this.context.lineWidth=this.stroke,this.context.arc(t,i,e,0,2*Math.PI),this.context.stroke()}arcRect(t,i){this.context.beginPath(),this.context.lineWidth=this.stroke,this.context.rect(this.x,this.y,t,i),this.context.stroke()}arcLine(t,i){this.context.beginPath(),this.context.lineWidth=this.stroke,this.context.moveTo(this.x,this.y),this.context.lineTo(t,i),this.context.stroke()}arcArrow(t,i,e){let s=Math.atan2(i-this.y,t-this.x)*(180/Math.PI),h=Math.abs(Math.sqrt((t-this.x)*(t-this.x)+(i-this.y)*(i-this.y))-15),n=1,o=2;h<50?(o=8,n=4):h>=50&&h<150&&(o=4,n=2);let a=this.x+Math.cos((-s-n)*Math.PI/180)*h,c=this.y-Math.sin((-s-n)*Math.PI/180)*h,r=this.x+Math.cos((-s+n)*Math.PI/180)*h,l=this.y-Math.sin((-s+n)*Math.PI/180)*h,d=this.x+Math.cos((-s-o)*Math.PI/180)*h,u=this.y-Math.sin((-s-o)*Math.PI/180)*h,x=this.x+Math.cos((-s+o)*Math.PI/180)*h,m=this.y-Math.sin((-s+o)*Math.PI/180)*h;return e.beginPath(),e.fillStyle=this.context.strokeStyle,e.moveTo(this.x,this.y),e.lineTo(a,c),e.lineTo(d,u),e.lineTo(t,i),e.lineTo(x,m),e.lineTo(r,l),e.lineTo(this.x,this.y),e.fill(),[[a,c],[d,u],[t,i],[x,m],[r,l]]}getMousePos(t){let i=this.canvas.getBoundingClientRect();return{x:t.clientX-i.left*(this.canvas.width/i.width),y:t.clientY-i.top*(this.canvas.height/i.height)}}resetCanvas(){this.stroke=1,this.x=0,this.y=0,this.radius=5,this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}}},function(t,i,e){"use strict";i.a=class{constructor(t){this.dom=document.getElementById(t),this.board=null,n.appendChild(o),o.appendChild(h),o.appendChild(r),o.appendChild(a),o.appendChild(c),this.cancel=this.cancel.bind(this),this.confirm=this.confirm.bind(this),this.drag=this.drag.bind(this),this.bindClick=this.bindClick.bind(this),this.moveAction=this.moveAction.bind(this),this.cancelMove=this.cancelMove.bind(this),a.addEventListener("click",this.cancel,!1),c.addEventListener("click",this.confirm,!1),navigator.userAgent.match(/AppleWebKit.*Mobile.*/)?r.addEventListener("touchstart",this.drag,!1):r.addEventListener("mousedown",this.drag,!1)}addText(t){this.board=t,this.dom.appendChild(l),u(t.color),setTimeout(()=>{this.dom.addEventListener("click",this.bindClick,!1)},0)}bindClick(t){let i=this.getMousePos(this.board.ctx.canvas,t);n.style.left=i.x+"px",n.style.top=i.y+"px",this.dom.appendChild(n),h.focus(),this.dom.removeEventListener("click",this.bindClick,!1),this.dom.removeChild(l)}cancel(){this.dom.removeChild(n),d(),this.dom.removeEventListener("mouseup",this.cancelMove,!0)}confirm(){let t=[];h.value.split(/[\r\n]/).forEach(i=>{let e=i.split(""),h="";for(let i=0;i<e.length;i++)h+=e[i],this.board.ctx.measureText(h).width>=s&&(t.push(h),h="");t.push(h)}),this.board.ctx.save(),this.board.ctx.fillStyle=this.board.color,this.board.ctx.font="16px Arial",this.board.ctx.beginPath();let i=n.offsetTop+20;t.forEach(t=>{this.board.ctx.fillText(t,n.offsetLeft+5,i),i+=20}),this.board.ctx.restore();let e=this.board.color,o=(n.offsetTop+20)/this.board.height,a=n.offsetLeft/this.board.width;this.board.emit("change",{type:"text",data:{x:a,y:o,color:e,data:t}}),this.dom.removeChild(n),d(),this.dom.removeEventListener("mouseup",this.cancelMove,!0)}drag(){navigator.userAgent.match(/AppleWebKit.*Mobile.*/)?(this.dom.addEventListener("touchmove",this.moveAction,!1),this.dom.addEventListener("touchend",this.cancelMove,!0)):(this.dom.addEventListener("mousemove",this.moveAction,!1),this.dom.addEventListener("mouseup",this.cancelMove,!0))}cancelMove(){navigator.userAgent.match(/AppleWebKit.*Mobile.*/)?this.dom.removeEventListener("touchmove",this.moveAction,!1):this.dom.removeEventListener("mousemove",this.moveAction,!1)}moveAction(t){let i=this.getMousePos(this.board.canvas,t);n.style.left=i.x+"px",n.style.top=i.y+"px"}getMousePos(t,i){let e=i.clientX||i.touches[0].clientX,s=i.clientY||i.touches[0].clientY;var h=t.getBoundingClientRect();return{x:e-h.left,y:s-h.top}}};const s=140,h=function(){let t=document.createElement("textarea");return t.setAttribute("rows",3),t.setAttribute("cols",30),t.style.cssText='display: block; background-color: transparent; outline: none; margin: 0px; padding: 4px; resize: none; overflow: hidden; z-index: 1000;font: 18px "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(0, 0, 0);',t}(),n=function(){let t=document.createElement("div");return t.style.cssText="position: absolute;width: auto;display: inline-block; text-align: right; z-index: 1000;",t}(),o=function(){let t=document.createElement("div");return t.style.cssText="position: relative;width: 100%;",t}(),a=function(){let t=document.createElement("button");return t.innerHTML="取消",t.style.cssText="margin-left: 10px;",t}(),c=function(){let t=document.createElement("button");return t.innerHTML="确定",t.style.cssText="margin-left: 10px;",t}(),r=function(){let t=document.createElement("button");return t.innerHTML="按下拖动",t.style.cssText="position: absolute; left: 0; top: -20px; z-index: 100;",t}(),l=function(){let t=document.createElement("div");return t.style.cssText="position: absolute;left:0;top:0; width: 100%;height: 100%;z-index: 999;",t}(),d=function(){h.value=""},u=t=>{h.style.color=t}},function(t,i,e){"use strict";i.a=class{constructor(t){let i=document.createElement("input");i.setAttribute("type","file"),i.setAttribute("accept","image/*"),i.addEventListener("change",()=>{s(i.files[0]).then(t=>{this.drawImage(t)}).catch(t=>{console.log(t)})},!1),this.base=t,this.input=i}drawImage(t){let i=document.createElement("img"),e=this;i.onload=function(){if(this.width<=e.base.width)e.base.ctx.drawImage(this,0,0);else{let t=e.base.width/this.width;e.base.ctx.drawImage(this,0,0,e.base.width,this.height*t)}e.base.emit("change",{type:"image",data:t}),e.input.value=""},i.onerror=function(t){throw t},i.src=t}importImage(){this.input.click()}importImageByBase64(t){this.drawImage(t)}};const s=t=>new Promise((i,e)=>{t||e(new Error("args error"));let s=new FileReader;s.onload=function(t){let e=t.target.result;i(e)},s.onerror=function(t){e(t)},s.readAsDataURL(t)})}]);